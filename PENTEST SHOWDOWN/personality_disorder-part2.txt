Title: Personality Disorder – Part 2
Category: Cryptography
Difficulty: Medium–High

-----------------------------------
Challenge Overview
-----------------------------------

The challenge provides an ECDSA public key and two valid signatures
on different messages. The author claims the system is secure because
ECDSA is an industry-standard algorithm and the private key is never
leaked.

Players are asked to prove key compromise by producing a valid
signature on a challenge message via a remote netcat service.

-----------------------------------
Observation
-----------------------------------

Both provided signatures share the same `r` value.

In ECDSA, the `r` value is derived from the nonce `k`. If two signatures
have the same `r`, the same nonce was reused. This violates ECDSA’s
security requirements and is a catastrophic implementation flaw.

-----------------------------------
ECDSA Background
-----------------------------------

ECDSA signature equation:

    s = k⁻¹ (z + r·d) mod n

Where:
    d = private key
    k = per-signature nonce
    z = hash(message)
    n = curve order

Nonce reuse allows the private key to be recovered.

-----------------------------------
Recovering the Nonce
-----------------------------------

Given two signatures using the same nonce:

    s1 = k⁻¹ (z1 + r·d)
    s2 = k⁻¹ (z2 + r·d)

Subtracting the equations:

    s1 − s2 = k⁻¹ (z1 − z2)

Solving for k:

    k = (z1 − z2) · (s1 − s2)⁻¹ mod n

-----------------------------------
Recovering the Private Key
-----------------------------------

Once k is known, the private key can be recovered:

    d = (s1·k − z1) · r⁻¹ mod n

All values required for this computation are known from the challenge
files.

-----------------------------------
Practical Exploitation
-----------------------------------

The messages are hashed using SHA-256. Using modular arithmetic, the
nonce and private key are recovered:

    d = 46449269947398895097211148206086499117253002158373605386693265621186384390129

This confirms complete compromise of the ECDSA signing key.

-----------------------------------
Proof of Key Recovery
-----------------------------------

The challenge uses a remote netcat service to verify key recovery.

Players must sign the following message using the recovered private key:

    "I have recovered your private key."

The service verifies the submitted `(r:s)` signature using the public
key. A valid signature proves possession of the private key.

-----------------------------------
Flag
-----------------------------------

Upon successful verification, the service returns:

    flag{nonce_reuse_is_fatal}

-----------------------------------
Conclusion
-----------------------------------

ECDSA’s security critically depends on the uniqueness and randomness
of the nonce `k`. Reusing a nonce instantly reveals the private key,
regardless of key size or curve strength.

This vulnerability has occurred in real-world systems, including
cryptocurrency wallets and TLS implementations.

-----------------------------------
Lesson Learned
-----------------------------------

Strong cryptography cannot survive weak randomness.
